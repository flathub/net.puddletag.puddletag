app-id: net.puddletag.puddletag

runtime: org.kde.Platform
runtime-version: 5.15-23.08
sdk: org.kde.Sdk
base: com.riverbankcomputing.PyQt.BaseApp
base-version: 5.15-23.08

command: puddletag
rename-desktop-file: puddletag.desktop
rename-icon: puddletag

finish-args:
  - --device=dri
  - --filesystem=xdg-music
  - --filesystem=xdg-download
  - --share=ipc
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=wayland

build-options:
  env:
    - BASEAPP_REMOVE_WEBENGINE=1
cleanup-commands:
  - /app/cleanup-BaseApp.sh

modules:
  - name: python3-configobj
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "configobj" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cb/87/17d4c6d634c044ab08b11c0cd2a8a136d103713d438f8792d7be2c5148fb/configobj-5.0.8.tar.gz
        sha256: 6f704434a07dc4f4dc7c9a745172c1cad449feb548febd9f7fe362629c627a97
        x-checker-data:
          type: pypi
          name: configobj

  - name: python3-mutagen
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "mutagen" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/81/e6/64bc71b74eef4b68e61eb921dcf72dabd9e4ec4af1e11891bbd312ccbb77/mutagen-1.47.0.tar.gz
        sha256: 719fadef0a978c31b4cf3c956261b3c58b6948b32023078a2117b1de09f0fc99
        x-checker-data:
          type: pypi
          name: mutagen

  - name: python3-pillow
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pillow" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/cd/74/ad3d526f3bf7b6d3f408b73fde271ec69dfac8b81341a318ce825f2b3812/pillow-10.4.0.tar.gz
        sha256: 166c1cd4d24309b30d61f79f4a9114b7b2313d7450912277855ff5dfd7cd4a06
        x-checker-data:
          type: pypi
          name: pillow

  - name: python3-unidecode
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "unidecode" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/f7/89/19151076a006b9ac0dd37b1354e031f5297891ee507eb624755e58e10d3e/Unidecode-1.3.8.tar.gz
        sha256: cfdb349d46ed3873ece4586b96aa75258726e2fa8ec21d6f00a591d98806c2f4
        x-checker-data:
          type: pypi
          name: unidecode

  - name: puddletag
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --skip-build --prefix=${FLATPAK_DEST} --root=/ --optimize=1
      - install -Dm644 /app/share/{pixmaps,icons/hicolor/256x256/apps}/puddletag.png
      - install -D -m 644 ${FLATPAK_ID}.appdata.xml /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - rm -r /app/share/pixmaps
    sources:
      - type: archive
        url: https://github.com/puddletag/puddletag/archive/refs/tags/2.4.0.tar.gz
        sha256: 892864eabdb9bea627087e6b342a861ec6b8400d7f8e706a85565d71a1fb1be3
        x-checker-data:
          type: anitya
          project-id: 3727
          stable-only: true
          url-template: https://github.com/puddletag/puddletag/archive/refs/tags/$version.tar.gz
      - type: file
        path: net.puddletag.puddletag.appdata.xml

  - name: chromaprint
    buildsystem: cmake-ninja
    sources:
      - type: archive
        url: https://github.com/acoustid/chromaprint/releases/download/v1.5.1/chromaprint-1.5.1.tar.gz
        sha256: a1aad8fa3b8b18b78d3755b3767faff9abb67242e01b478ec9a64e190f335e1c
        x-checker-data:
          type: anitya
          project-id: 286
          stable-only: true
          url-template: https://github.com/acoustid/chromaprint/releases/download/v$version/chromaprint-$version.tar.gz
